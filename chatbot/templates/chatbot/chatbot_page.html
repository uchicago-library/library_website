{% extends "base/public_base.html" %}
{% load wagtailcore_tags %}
{% load django_htmx %}

{% block extra_scripts %}
    <style>
        .htmx-indicator {
            opacity: 0;
            transition: opacity 200ms ease-in;
        }
        .htmx-request .htmx-indicator {
            opacity: 1;
        }
        .fa-spin {
            margin-right: 8px;
        }
        .answer-heading {
            margin-bottom: 0;
        }
    </style>
    {% htmx_script %}
{% endblock %}

{% block content %}
    <div class="container py-4">
        <div class="row">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-body">
                        <!-- Form with htmx attributes for AJAX submission -->
                        <form hx-get="{{ page.url }}" hx-target="#results-container" hx-indicator="#loading-indicator"
                            hx-trigger="submit" class="mb-0">
                            <div class="form-group">
                                <label for="chatbot-query" class="form-label">Ask a question:</label>
                                <textarea class="form-control" id="chatbot-query" name="q" rows="3"
                                    placeholder="Type your question here...">{{ query|default:'' }}</textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Search</button>
                        </form>
                    </div>
                </div>
                <!-- Loading indicator that only shows during AJAX requests -->
                <div id="loading-indicator" class="htmx-indicator text-center my-4">
                    <div class="spinner-border" role="status">
                        <i class="fa fa-refresh fa-spin fa-fw" aria-hidden="true"></i>
                        <span>Querying LibBot...</span>
                    </div>
                </div>
                <!-- Results container that will be updated by htmx -->
                <div id="results-container">
                    {% include "chatbot/results_partial.html" %}
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
